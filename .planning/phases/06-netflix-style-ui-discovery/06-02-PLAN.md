---
phase: 06-netflix-style-ui-discovery
plan: 02
type: execute
wave: 2
depends_on: ["06-01"]
files_modified:
  - frontend/src/components/movies/Carousel.tsx
  - frontend/src/components/movies/CarouselCard.tsx
  - frontend/src/app/browse/page.tsx
  - frontend/src/hooks/useMoviesByGenre.ts
  - frontend/src/lib/api.ts
  - backend/routers/movies.py
  - backend/services/tmdb.py
autonomous: true

must_haves:
  truths:
    - "Browse page displays movies in horizontal scrolling carousels organized by category"
    - "At least 3 carousel rows exist: Trending Now, Recommended for You, and a genre-based row"
    - "Carousels support smooth horizontal scrolling with left/right navigation arrows"
    - "Movies in carousels animate in with stagger reveal using framer-motion"
    - "Carousels are responsive: fewer visible cards on mobile, more on desktop"
    - "Browse page retains search functionality and pagination for full catalog browsing below carousels"
  artifacts:
    - path: "frontend/src/components/movies/Carousel.tsx"
      provides: "Reusable horizontal scroll carousel with navigation arrows and stagger animations"
      min_lines: 60
    - path: "frontend/src/app/browse/page.tsx"
      provides: "Restructured browse page with carousel rows + catalog grid"
      min_lines: 40
    - path: "frontend/src/hooks/useMoviesByGenre.ts"
      provides: "TanStack Query hook for fetching movies by genre"
      min_lines: 10
    - path: "backend/routers/movies.py"
      provides: "GET /api/movies/genre/{genre_id} endpoint"
      exports: ["get_movies_by_genre"]
  key_links:
    - from: "frontend/src/app/browse/page.tsx"
      to: "frontend/src/components/movies/Carousel.tsx"
      via: "component import and rendering"
      pattern: "import.*Carousel"
    - from: "frontend/src/components/movies/Carousel.tsx"
      to: "framer-motion"
      via: "stagger reveal animation"
      pattern: "motion\\."
    - from: "frontend/src/hooks/useMoviesByGenre.ts"
      to: "/api/movies/genre"
      via: "fetch"
      pattern: "api/movies/genre"
---

<objective>
Build horizontal scrolling carousels with framer-motion stagger animations that organize movies by category on the browse page.

Purpose: REQ-UI-02 requires Netflix-style horizontal scroll carousels replacing the flat grid. REQ-UI-04 requires responsive design. The browse page currently shows a simple MovieGrid -- this plan layers carousels on top (Trending, Recommended, genre rows) while preserving the existing grid+search+pagination below as a full catalog section.

Output: Browse page with multiple horizontal carousel rows (trending, recommendations, genre-based) using smooth stagger animations, plus the existing grid catalog below.
</objective>

<execution_context>
@./.claude/get-shit-done/workflows/execute-plan.md
@./.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@frontend/src/app/browse/page.tsx
@frontend/src/components/movies/MovieCard.tsx
@frontend/src/components/movies/MovieGrid.tsx
@frontend/src/components/recommendations/RecommendationSection.tsx
@frontend/src/hooks/useRecommendations.ts
@frontend/src/types/movie.ts
@frontend/src/lib/api.ts
@frontend/src/app/globals.css
@backend/routers/movies.py
@backend/services/tmdb.py
</context>

<tasks>

<task type="auto">
  <name>Task 1: Genre endpoint + Carousel component with stagger animations</name>
  <files>
    backend/routers/movies.py
    backend/services/tmdb.py
    frontend/src/lib/api.ts
    frontend/src/hooks/useMoviesByGenre.ts
    frontend/src/components/movies/Carousel.tsx
    frontend/src/components/movies/CarouselCard.tsx
  </files>
  <action>
    1. In `backend/routers/movies.py`, add endpoint `GET /api/movies/genre/{genre_id}` BEFORE the `/{movie_id}` catch-all route:
       - Accepts genre_id as path param (int), page as query param (default 1)
       - Calls TMDB discover endpoint via tmdb_service: `tmdb_service.discover_by_genre(genre_id, page)`
       - Add method `discover_by_genre(self, genre_id: int, page: int = 1)` to TMDBService in `backend/services/tmdb.py`:
         * URL: `https://api.themoviedb.org/3/discover/movie`
         * Params: `with_genres={genre_id}`, `sort_by=popularity.desc`, `page={page}`
         * Returns same PaginatedMovieResponse shape
       - Returns PaginatedMovieResponse

    2. In `frontend/src/lib/api.ts`, add:
       ```typescript
       export async function fetchMoviesByGenre(genreId: number, page: number = 1): Promise<PaginatedResponse<Movie>> {
         const res = await fetch(`${API_URL}/api/movies/genre/${genreId}?page=${page}`, { cache: "no-store" });
         if (!res.ok) throw new Error(res.statusText);
         return res.json();
       }
       ```

    3. Create `frontend/src/hooks/useMoviesByGenre.ts`:
       - Export `useMoviesByGenre(genreId: number)` using TanStack Query
       - queryKey: ['movies-genre', genreId]
       - Calls fetchMoviesByGenre, returns data.results (Movie[])
       - staleTime: 1000 * 60 * 10 (10 minutes)

    4. Create `frontend/src/components/movies/CarouselCard.tsx` ("use client"):
       - A compact movie card optimized for carousel display (wider min-width than MovieCard)
       - Props: movie: Movie
       - Renders: Link to /movies/${movie.id}, poster Image (w342 size), hover scale effect (hover:scale-105 transition-transform duration-200)
       - Fixed width: min-w-[160px] w-[160px] md:min-w-[180px] md:w-[180px] lg:min-w-[200px] lg:w-[200px]
       - Aspect ratio 2:3, rounded-lg overflow-hidden
       - On hover: show title overlay at bottom (bg-gradient-to-t from-black/80 to-transparent, text-sm font-medium text-white p-2)
       - Import and use the existing engagement overlay pattern from MovieCard (StarRating + WatchlistButton on hover), but only show on md+ screens to avoid clutter on mobile

    5. Create `frontend/src/components/movies/Carousel.tsx` ("use client"):
       - Props: `title: string`, `movies: Movie[]`, `isLoading?: boolean`, `subtitle?: string`
       - Layout:
         * Section header: title (text-xl font-semibold text-white) + optional subtitle (text-sm text-slate-400)
         * Horizontal scroll container: `ref={scrollRef}` with `overflow-x-auto scrollbar-hide flex gap-3 pb-4 relative`
         * Left/right navigation arrow buttons (absolute positioned, visible on hover of the carousel section):
           - ChevronLeft/ChevronRight from lucide-react
           - bg-slate-900/80 hover:bg-slate-900 backdrop-blur-sm rounded-full p-2
           - onClick scrolls the container by `scrollRef.current.clientWidth * 0.8` (smooth scroll)
           - Hide left arrow when scrolled to start, hide right arrow when scrolled to end (track with scroll event + state)
         * Each movie card wrapped in framer-motion `motion.div` with stagger animation:
           - Parent: no stagger orchestrator needed -- use individual delays
           - Each card: `initial={{ opacity: 0, y: 20 }}`, `animate={{ opacity: 1, y: 0 }}`, `transition={{ duration: 0.4, delay: index * 0.05 }}` (cap delay at index 10 to avoid long waits: `Math.min(index * 0.05, 0.5)`)
           - Use `whileInView` instead of `animate` so cards only animate when scrolled into view: `whileInView={{ opacity: 1, y: 0 }}`, `viewport={{ once: true, amount: 0.3 }}`
         * Render CarouselCard for each movie
       - Loading state: 6 skeleton cards (same size as CarouselCard, bg-slate-700 animate-pulse rounded-lg)
       - Empty state: return null (don't show empty carousels)
  </action>
  <verify>
    Run `curl http://localhost:8000/api/movies/genre/28` to confirm genre endpoint returns action movies. Run `cd /Users/zacharym/netflixrecs/frontend && npx next build` to verify TypeScript compilation.
  </verify>
  <done>Carousel component renders horizontal scrollable rows with stagger animations, navigation arrows, and responsive card sizing. Backend serves movies by genre. CarouselCard provides compact poster-focused display.</done>
</task>

<task type="auto">
  <name>Task 2: Restructure browse page with carousel rows</name>
  <files>
    frontend/src/app/browse/page.tsx
  </files>
  <action>
    Restructure `frontend/src/app/browse/page.tsx` to show carousel rows above the existing catalog grid:

    1. Keep the existing "use client", imports, state, search/pagination logic intact.

    2. Add imports:
       - Carousel from @/components/movies/Carousel
       - useRecommendations from @/hooks/useRecommendations (already used via RecommendationSection, but now use directly)
       - useMoviesByGenre from @/hooks/useMoviesByGenre
       - Movie type from @/types/movie

    3. Add hooks at component top:
       - `const { data: trendingData, isLoading: trendingLoading } = useQuery({ queryKey: ['movies', '', 1], queryFn: () => fetchMovies(1) })` -- reuse the popular movies as "Trending Now"
       - `const { data: recData, isLoading: recLoading } = useRecommendations(15)` -- get 15 recommendations for carousel
       - `const { data: actionData, isLoading: actionLoading } = useMoviesByGenre(28)` -- Action movies
       - `const { data: scifiData, isLoading: scifiLoading } = useMoviesByGenre(878)` -- Sci-Fi movies
       - `const { data: thrillerData, isLoading: thrillerLoading } = useMoviesByGenre(53)` -- Thriller movies

    4. Convert recommendation data to Movie[] using the same mapping pattern from the existing RecommendationSection (map rec fields to Movie interface).

    5. New page structure:
       ```
       <div className="space-y-8">
         {/* Carousel Section */}
         <section className="space-y-6">
           <Carousel title="Trending Now" movies={trendingData?.results ?? []} isLoading={trendingLoading} />

           <Carousel
             title={recData?.strategy === 'popularity_fallback' ? 'Popular Right Now' : 'Recommended for You'}
             subtitle={recData?.strategy === 'hybrid_collaborative_heavy' ? 'Powered by users with similar taste' : undefined}
             movies={recommendationMovies}
             isLoading={recLoading}
           />

           <Carousel title="Action & Adventure" movies={actionData ?? []} isLoading={actionLoading} />
           <Carousel title="Sci-Fi" movies={scifiData ?? []} isLoading={scifiLoading} />
           <Carousel title="Thrillers" movies={thrillerData ?? []} isLoading={thrillerLoading} />
         </section>

         {/* Divider */}
         <div className="border-t border-slate-700 pt-8">
           {/* Existing catalog section: search bar, MovieGrid, pagination -- keep exactly as-is */}
           <div className="flex flex-col sm:flex-row ...">
             <h1>Full Catalog</h1>
             <SearchBar ... />
           </div>
           ...MovieGrid + pagination...
         </div>
       </div>
       ```

    6. Remove the old `<RecommendationSection />` import and usage since recommendations are now shown via Carousel.

    7. The "Why this?" (ExplanationButton) functionality is lost in carousel mode -- this is acceptable since the explanation is also accessible from the movie detail page. The carousel is for quick browsing, not deep exploration.

    Responsive: Carousel component handles responsive card sizing internally. Browse page layout uses space-y-8 which works across breakpoints.
  </action>
  <verify>
    Run `cd /Users/zacharym/netflixrecs/frontend && npx next build` to verify compilation. Visually verify at http://localhost:3000/browse that carousel rows appear above the catalog grid with horizontal scrolling, stagger animations on scroll, and navigation arrows.
  </verify>
  <done>Browse page displays 5 horizontal carousel rows (Trending, Recommended, Action, Sci-Fi, Thrillers) with stagger animations above the full catalog grid. Search and pagination still work. Responsive across mobile/tablet/desktop.</done>
</task>

</tasks>

<verification>
- Browse page at /browse shows at least 3 horizontal carousel rows with movie posters
- Carousels scroll horizontally with left/right arrow navigation
- Movies in carousels animate in with stagger reveal when scrolling into view
- Carousels are responsive: cards resize appropriately on mobile vs desktop
- Full catalog grid with search + pagination still exists below the carousels
- `curl http://localhost:8000/api/movies/genre/28` returns action movies
- `npx next build` compiles without errors
</verification>

<success_criteria>
Browse page features horizontal scrolling carousels organized by category (Trending, Recommended, genre-based) with framer-motion stagger reveal animations. Navigation arrows allow scrolling through cards. The existing catalog grid and search remain available below. Layout is fully responsive.
</success_criteria>

<output>
After completion, create `.planning/phases/06-netflix-style-ui-discovery/06-02-SUMMARY.md`
</output>
