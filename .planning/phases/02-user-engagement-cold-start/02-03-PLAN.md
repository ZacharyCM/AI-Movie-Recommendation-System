---
phase: 02-user-engagement-cold-start
plan: 03
type: execute
wave: 2
depends_on: ["02-01"]
files_modified:
  - frontend/src/app/profile/page.tsx
  - frontend/src/components/profile/ProfileHeader.tsx
  - frontend/src/components/profile/RatingHistory.tsx
  - frontend/src/components/profile/WatchlistGrid.tsx
  - frontend/src/components/layout/Navbar.tsx
autonomous: true

must_haves:
  truths:
    - "Profile page displays user's username, email, avatar placeholder, and member-since date"
    - "Profile page shows rating history as a list of rated movies with star ratings"
    - "Profile page shows watchlist as a grid of bookmarked movie posters"
    - "Profile page shows viewing stats (total ratings, total watchlist, average rating)"
    - "Navbar has a link to the profile page"
  artifacts:
    - path: "frontend/src/app/profile/page.tsx"
      provides: "User profile page"
      contains: "ProfileHeader"
    - path: "frontend/src/components/profile/ProfileHeader.tsx"
      provides: "Profile header with avatar, name, stats"
      contains: "UserStats"
    - path: "frontend/src/components/profile/RatingHistory.tsx"
      provides: "List of user's rated movies"
      contains: "StarRating"
    - path: "frontend/src/components/profile/WatchlistGrid.tsx"
      provides: "Grid of watchlisted movies"
      contains: "watchlist"
    - path: "frontend/src/components/layout/Navbar.tsx"
      provides: "Navigation with profile link"
      contains: "profile"
  key_links:
    - from: "frontend/src/app/profile/page.tsx"
      to: "useProfile hook"
      via: "import"
      pattern: "useProfile"
    - from: "frontend/src/components/profile/RatingHistory.tsx"
      to: "useUserRatings hook"
      via: "import"
      pattern: "useUserRatings"
---

<objective>
Build the user profile page showing rating history, watchlist, viewing stats, and account info.

Purpose: REQ-ENG-04 requires a profile page where users can see their engagement data. This is also where taste data becomes visible, building confidence that the app "knows" them. The page aggregates data from hooks built in 02-01.

Output: /profile route with ProfileHeader (name, avatar, stats), RatingHistory (rated movies with stars), WatchlistGrid (bookmarked movies), and Navbar profile link.
</objective>

<execution_context>
@./.claude/get-shit-done/workflows/execute-plan.md
@./.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/02-user-engagement-cold-start/02-RESEARCH.md
@frontend/src/components/layout/Navbar.tsx
@frontend/src/hooks/useAuth.ts
@frontend/src/hooks/useRatings.ts
@frontend/src/hooks/useWatchlist.ts
@frontend/src/hooks/useProfile.ts
@frontend/src/types/database.ts
@frontend/src/types/movie.ts
@frontend/src/lib/api.ts
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create profile page components</name>
  <files>
    frontend/src/components/profile/ProfileHeader.tsx
    frontend/src/components/profile/RatingHistory.tsx
    frontend/src/components/profile/WatchlistGrid.tsx
  </files>
  <action>
**ProfileHeader** (`frontend/src/components/profile/ProfileHeader.tsx`):
- `'use client'` directive
- Props: `user: User` (from @supabase/supabase-js), `stats: UserStats` (from @/types/database)
- Display:
  - Avatar: Circle with user initial (first letter of email or username) in slate-700 bg, large (w-20 h-20). If avatar_url exists on profile, show Image.
  - Username or email beside avatar
  - Member since date (formatted from user.created_at)
  - Stats row: "X movies rated", "X on watchlist", "Avg rating: X.X â˜…"
- Dark theme styling consistent with rest of app (slate-800 bg cards, slate-200 text)

**RatingHistory** (`frontend/src/components/profile/RatingHistory.tsx`):
- `'use client'` directive
- Props: `ratings: Rating[]` (from @/types/database)
- For each rating, fetch movie info from TMDB API to display title and poster. Use `useQuery` with query key `['movie', rating.movie_id]` to fetch each movie detail via `fetchMovieDetail` from `@/lib/api`.
- Display as a vertical list, each item showing:
  - Movie poster thumbnail (small, w-12 aspect-2/3)
  - Movie title (linked to /movies/[id])
  - StarRating component in readonly mode showing the user's rating
  - Date rated (formatted from rating.created_at)
- Sort by most recently rated first (created_at desc)
- Show "No ratings yet. Start rating movies!" empty state
- Limit to 20 most recent ratings with a "View all" expander if more exist

**WatchlistGrid** (`frontend/src/components/profile/WatchlistGrid.tsx`):
- `'use client'` directive
- Props: `watchlistItems: WatchlistItem[]` (from @/types/database)
- Similar to RatingHistory, fetch movie details for each item using `useQuery`
- Display as a responsive grid (similar layout to MovieGrid but smaller) showing poster thumbnails
- Each poster links to /movies/[id]
- Show "Your watchlist is empty. Browse movies and bookmark ones you want to watch!" empty state
  </action>
  <verify>
    - `ls frontend/src/components/profile/ProfileHeader.tsx` exists
    - `ls frontend/src/components/profile/RatingHistory.tsx` exists
    - `ls frontend/src/components/profile/WatchlistGrid.tsx` exists
    - `grep "StarRating" frontend/src/components/profile/RatingHistory.tsx` confirms readonly rating display
    - `cd frontend && npx tsc --noEmit` compiles
  </verify>
  <done>
    ProfileHeader shows user info and stats. RatingHistory shows rated movies with star ratings and poster thumbnails. WatchlistGrid shows bookmarked movies in a grid. All components compile.
  </done>
</task>

<task type="auto">
  <name>Task 2: Create profile page route and add Navbar link</name>
  <files>
    frontend/src/app/profile/page.tsx
    frontend/src/components/layout/Navbar.tsx
  </files>
  <action>
**Profile page** (`frontend/src/app/profile/page.tsx`):
- `'use client'` directive
- Import and use: `useAuth` hook for user data, `useProfile` and `useUserStats` from `@/hooks/useProfile`, `useUserRatings` from `@/hooks/useRatings`, `useUserWatchlist` from `@/hooks/useWatchlist`
- Import Navbar component
- Layout:
  - Navbar at top
  - Main content area with max-w-4xl mx-auto, pt-16 for navbar offset
  - ProfileHeader section at top
  - Two-column layout below on large screens (lg:flex):
    - Left column (lg:w-1/2): RatingHistory
    - Right column (lg:w-1/2): WatchlistGrid
  - Single column on mobile
- Loading state: Show skeleton placeholders while data loads
- Handle unauthenticated state: redirect to /login (middleware already handles this, but add a guard for the user hook)

**Navbar update** (`frontend/src/components/layout/Navbar.tsx`):
- Add a profile icon/link between the logo and the LogoutButton
- Import `User` icon from `lucide-react`
- Add `<Link href="/profile">` with the User icon and text "Profile"
- Style: `text-slate-400 hover:text-white transition flex items-center gap-1 text-sm`
- Keep existing layout: logo on left, profile + logout on right (use flex gap)
  </action>
  <verify>
    - `ls frontend/src/app/profile/page.tsx` exists
    - `grep "ProfileHeader" frontend/src/app/profile/page.tsx` confirms component usage
    - `grep "RatingHistory" frontend/src/app/profile/page.tsx` confirms component usage
    - `grep "WatchlistGrid" frontend/src/app/profile/page.tsx` confirms component usage
    - `grep "profile" frontend/src/components/layout/Navbar.tsx` confirms link added
    - `cd frontend && npx tsc --noEmit` compiles
  </verify>
  <done>
    Profile page at /profile shows user info, rating history, watchlist, and stats. Navbar has a profile link. TypeScript compiles.
  </done>
</task>

</tasks>

<verification>
- TypeScript compilation passes: `cd frontend && npx tsc --noEmit`
- Profile page accessible at /profile
- Navbar shows profile link
- ProfileHeader shows user info and stats
- RatingHistory shows rated movies with readonly star display
- WatchlistGrid shows bookmarked movie posters
- Empty states shown when no data
</verification>

<success_criteria>
- User can navigate to /profile from Navbar
- Profile page displays username/email, member since, and engagement stats
- Rating history shows all rated movies with star ratings
- Watchlist shows all bookmarked movies in a grid
- Page handles loading and empty states gracefully
</success_criteria>

<output>
After completion, create `.planning/phases/02-user-engagement-cold-start/02-03-SUMMARY.md`
</output>
