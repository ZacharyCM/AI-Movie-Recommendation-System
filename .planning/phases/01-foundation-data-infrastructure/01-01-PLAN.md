---
phase: 01-foundation-data-infrastructure
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - frontend/package.json
  - frontend/next.config.ts
  - frontend/tailwind.config.ts
  - frontend/postcss.config.mjs
  - frontend/tsconfig.json
  - frontend/src/app/layout.tsx
  - frontend/src/app/page.tsx
  - frontend/src/app/globals.css
  - frontend/.env.local.example
  - frontend/.gitignore
  - backend/main.py
  - backend/requirements.txt
  - backend/.env.example
  - backend/.gitignore
  - frontend/src/lib/supabase/client.ts
  - frontend/src/lib/supabase/server.ts
  - frontend/src/lib/supabase/middleware.ts
  - backend/services/tmdb.py
  - backend/config.py
  - frontend/src/types/movie.ts
autonomous: true
user_setup:
  - service: supabase
    why: "Authentication and PostgreSQL database for user data"
    env_vars:
      - name: NEXT_PUBLIC_SUPABASE_URL
        source: "Supabase Dashboard -> Project Settings -> API -> Project URL"
      - name: NEXT_PUBLIC_SUPABASE_ANON_KEY
        source: "Supabase Dashboard -> Project Settings -> API -> anon public key"
    dashboard_config:
      - task: "Create a new Supabase project"
        location: "https://supabase.com/dashboard -> New Project"
      - task: "Enable email/password auth provider"
        location: "Supabase Dashboard -> Authentication -> Providers -> Email"
  - service: tmdb
    why: "Movie and TV show catalog data, images, and trailers"
    env_vars:
      - name: TMDB_API_KEY
        source: "TMDB -> Settings -> API -> API Key (v3 auth)"
    dashboard_config:
      - task: "Create a TMDB account and request an API key"
        location: "https://www.themoviedb.org/settings/api"

must_haves:
  truths:
    - "Next.js frontend dev server starts without errors on port 3000"
    - "FastAPI backend dev server starts without errors on port 8000"
    - "Supabase client can be imported and initialized in frontend code"
    - "TMDB API client can fetch movie data when API key is configured"
    - "Tailwind CSS classes render correctly in the browser"
  artifacts:
    - path: "frontend/package.json"
      provides: "Next.js project with dependencies"
      contains: "next"
    - path: "frontend/src/app/layout.tsx"
      provides: "Root layout with dark theme base"
      min_lines: 15
    - path: "backend/main.py"
      provides: "FastAPI application entry point with CORS"
      contains: "FastAPI"
    - path: "frontend/src/lib/supabase/client.ts"
      provides: "Browser Supabase client"
      contains: "createBrowserClient"
    - path: "backend/services/tmdb.py"
      provides: "TMDB API client service"
      contains: "TMDB_API_KEY"
    - path: "frontend/src/types/movie.ts"
      provides: "Shared Movie TypeScript types"
      contains: "interface Movie"
  key_links:
    - from: "frontend/src/lib/supabase/client.ts"
      to: "Supabase project"
      via: "NEXT_PUBLIC_SUPABASE_URL env var"
      pattern: "NEXT_PUBLIC_SUPABASE_URL"
    - from: "backend/services/tmdb.py"
      to: "TMDB API"
      via: "TMDB_API_KEY env var"
      pattern: "TMDB_API_KEY"
---

<objective>
Initialize the NetflixRecs project with a Next.js frontend and FastAPI backend, configure Supabase auth client and TMDB API client, and define shared types.

Purpose: Establish the foundational project structure, tooling, and external service configuration that all subsequent plans depend on. Nothing can be built until the projects exist and can connect to Supabase and TMDB.

Output: Runnable Next.js frontend (port 3000) and FastAPI backend (port 8000) with configured Supabase and TMDB clients ready for use by auth and catalog features.
</objective>

<execution_context>
@./.claude/get-shit-done/workflows/execute-plan.md
@./.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Scaffold Next.js frontend and FastAPI backend projects</name>
  <files>
    frontend/package.json
    frontend/next.config.ts
    frontend/tailwind.config.ts
    frontend/postcss.config.mjs
    frontend/tsconfig.json
    frontend/src/app/layout.tsx
    frontend/src/app/page.tsx
    frontend/src/app/globals.css
    frontend/.env.local.example
    frontend/.gitignore
    backend/main.py
    backend/requirements.txt
    backend/.env.example
    backend/.gitignore
    backend/config.py
  </files>
  <action>
    Create a `frontend/` directory at project root. Initialize a Next.js 14+ App Router project with TypeScript:
    - Run `npx create-next-app@latest frontend --typescript --tailwind --eslint --app --src-dir --import-alias "@/*" --no-git` from project root
    - After scaffolding, update `frontend/src/app/globals.css` to set dark mode base: body background `#0f172a` (slate-900), text `#e2e8f0` (slate-200)
    - Update `frontend/src/app/layout.tsx`: set metadata title "NetflixRecs", add `className="dark"` to html element, set body class to `bg-slate-900 text-slate-200 min-h-screen`
    - Update `frontend/src/app/page.tsx`: simple landing page with "NetflixRecs" heading and "Your AI-powered movie recommendation engine" subtitle, centered. This is a placeholder.
    - Create `frontend/.env.local.example` with placeholder vars: `NEXT_PUBLIC_SUPABASE_URL=your_supabase_url`, `NEXT_PUBLIC_SUPABASE_ANON_KEY=your_supabase_anon_key`, `NEXT_PUBLIC_API_URL=http://localhost:8000`
    - Install additional frontend deps: `npm install @supabase/ssr @supabase/supabase-js zustand @tanstack/react-query framer-motion`
    - Verify `npm run dev` starts successfully, then stop it

    Create a `backend/` directory at project root:
    - Create `backend/requirements.txt` with: `fastapi==0.115.0`, `uvicorn[standard]==0.30.0`, `httpx==0.27.0`, `python-dotenv==1.0.1`, `pydantic==2.9.0`, `pydantic-settings==2.5.0`
    - Create `backend/config.py`: use pydantic-settings `BaseSettings` to load `TMDB_API_KEY` and `FRONTEND_URL` (default `http://localhost:3000`) from environment / .env file
    - Create `backend/main.py`: FastAPI app with CORS middleware allowing `FRONTEND_URL` origin, GET `/health` endpoint returning `{"status": "ok"}`. Import settings from config.py. Use `from dotenv import load_dotenv; load_dotenv()` at module level.
    - Create `backend/.env.example` with: `TMDB_API_KEY=your_tmdb_api_key`, `FRONTEND_URL=http://localhost:3000`
    - Create `backend/.gitignore` with: `__pycache__/`, `*.pyc`, `.env`, `venv/`, `.venv/`
    - Set up Python virtual environment: `cd backend && python3 -m venv venv && source venv/bin/activate && pip install -r requirements.txt`
    - Verify `uvicorn main:app --reload` starts and `curl http://localhost:8000/health` returns ok, then stop it
  </action>
  <verify>
    - `cd frontend && npm run dev` starts Next.js on port 3000 (stop after confirming)
    - `cd backend && source venv/bin/activate && uvicorn main:app --host 0.0.0.0 --port 8000` starts FastAPI (stop after confirming)
    - `curl http://localhost:8000/health` returns `{"status":"ok"}`
    - Opening http://localhost:3000 shows the dark-themed NetflixRecs placeholder page
  </verify>
  <done>Both frontend (Next.js on 3000) and backend (FastAPI on 8000) start without errors. Dark mode base theme visible. Health endpoint returns ok.</done>
</task>

<task type="auto">
  <name>Task 2: Configure Supabase client, TMDB API client, and shared Movie types</name>
  <files>
    frontend/src/lib/supabase/client.ts
    frontend/src/lib/supabase/server.ts
    frontend/src/lib/supabase/middleware.ts
    backend/services/tmdb.py
    frontend/src/types/movie.ts
  </files>
  <action>
    Create Supabase client utilities for Next.js App Router (following Supabase SSR pattern with @supabase/ssr):

    `frontend/src/lib/supabase/client.ts`:
    - Export `createClient()` function that returns a browser Supabase client using `createBrowserClient` from `@supabase/ssr`
    - Uses `process.env.NEXT_PUBLIC_SUPABASE_URL!` and `process.env.NEXT_PUBLIC_SUPABASE_ANON_KEY!`

    `frontend/src/lib/supabase/server.ts`:
    - Export async `createClient()` function for Server Components / Route Handlers
    - Uses `createServerClient` from `@supabase/ssr` with cookie handling via `next/headers` cookies()
    - Implements `getAll` and `setAll` cookie methods per Supabase SSR docs

    `frontend/src/lib/supabase/middleware.ts`:
    - Export `updateSession(request: NextRequest)` function
    - Creates server client with request/response cookie bridging for session refresh
    - Returns the response with updated cookies
    - This will be used by the root middleware.ts in Plan 02

    Create TMDB API client for FastAPI backend:

    `backend/services/__init__.py`: empty file
    `backend/services/tmdb.py`:
    - Import `httpx` for async HTTP calls and settings from config
    - Define constants: `TMDB_BASE_URL = "https://api.themoviedb.org/3"`, `TMDB_IMAGE_BASE = "https://image.tmdb.org/t/p"`
    - Create class `TMDBService` with async methods:
      - `get_popular(page: int = 1)` -> calls `/movie/popular` with api_key param, returns parsed response
      - `search_movies(query: str, page: int = 1)` -> calls `/search/movie` with query + api_key params
      - `get_movie_details(movie_id: int)` -> calls `/movie/{movie_id}` with `append_to_response=credits,videos` for cast + trailers
    - Each method uses `httpx.AsyncClient` context manager, raises `httpx.HTTPStatusError` on failure
    - Include helper to build full image URLs: `get_image_url(path: str, size: str = "w500") -> str`

    Create shared TypeScript types:

    `frontend/src/types/movie.ts`:
    - `interface Movie { id: number; title: string; overview: string; poster_path: string | null; backdrop_path: string | null; release_date: string; vote_average: number; vote_count: number; genre_ids: number[]; }`
    - `interface MovieDetail extends Movie { runtime: number | null; genres: { id: number; name: string }[]; tagline: string | null; credits: { cast: CastMember[] }; videos: { results: Video[] }; }`
    - `interface CastMember { id: number; name: string; character: string; profile_path: string | null; order: number; }`
    - `interface Video { id: string; key: string; name: string; site: string; type: string; }`
    - `interface PaginatedResponse<T> { page: number; results: T[]; total_pages: number; total_results: number; }`
    - Export `TMDB_IMAGE_BASE = "https://image.tmdb.org/t/p"` constant and helper `getImageUrl(path: string | null, size?: string): string` that returns full URL or a placeholder
  </action>
  <verify>
    - `frontend/src/lib/supabase/client.ts` compiles without TypeScript errors: `cd frontend && npx tsc --noEmit`
    - `backend/services/tmdb.py` has no Python syntax errors: `cd backend && python -c "from services.tmdb import TMDBService"`
    - `frontend/src/types/movie.ts` exports Movie, MovieDetail, CastMember, Video, PaginatedResponse types
  </verify>
  <done>Supabase browser/server/middleware clients configured and importable. TMDB service class with popular/search/detail methods created. Movie TypeScript types defined with all TMDB fields needed by catalog and detail pages.</done>
</task>

</tasks>

<verification>
- `npm run dev` in frontend/ starts without errors
- `uvicorn main:app --reload` in backend/ starts without errors
- TypeScript compilation passes: `cd frontend && npx tsc --noEmit`
- Python imports work: `cd backend && python -c "from services.tmdb import TMDBService; from config import Settings"`
- `.env.local.example` and `.env.example` document all required env vars
</verification>

<success_criteria>
1. Next.js frontend starts on port 3000 with dark slate theme
2. FastAPI backend starts on port 8000 with /health endpoint
3. Supabase client utilities exist for browser, server, and middleware contexts
4. TMDB service class can fetch popular movies, search, and movie details
5. Movie TypeScript types cover all fields needed for grid and detail views
6. Environment variable templates document Supabase and TMDB configuration
</success_criteria>

<output>
After completion, create `.planning/phases/01-foundation-data-infrastructure/01-01-SUMMARY.md`
</output>
