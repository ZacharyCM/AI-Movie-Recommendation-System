---
phase: 01-foundation-data-infrastructure
plan: 04
type: execute
wave: 3
depends_on: ["01-02", "01-03"]
files_modified:
  - frontend/src/app/browse/page.tsx
  - frontend/src/app/browse/layout.tsx
  - frontend/src/components/movies/MovieGrid.tsx
  - frontend/src/components/movies/MovieCard.tsx
  - frontend/src/components/movies/SearchBar.tsx
  - frontend/src/components/layout/Navbar.tsx
  - frontend/src/app/movies/[id]/page.tsx
  - frontend/src/components/movies/MovieDetail.tsx
  - frontend/src/lib/api.ts
  - frontend/next.config.ts
autonomous: false

must_haves:
  truths:
    - "User sees a grid of movie posters with titles when visiting /browse"
    - "User can click 'Load More' or paginate to see additional movies beyond the first page"
    - "User can type a movie title in the search bar and see filtered results"
    - "User can click a movie card and navigate to a detail page with synopsis, cast, trailer, and backdrop"
    - "Navbar shows NetflixRecs branding and a Sign Out button for logged-in users"
    - "Movie poster images load from TMDB and display correctly"
  artifacts:
    - path: "frontend/src/app/browse/page.tsx"
      provides: "Catalog browse page with grid and search"
      min_lines: 30
    - path: "frontend/src/components/movies/MovieGrid.tsx"
      provides: "Responsive movie poster grid"
      min_lines: 20
    - path: "frontend/src/components/movies/MovieCard.tsx"
      provides: "Individual movie card with poster and title"
      min_lines: 15
    - path: "frontend/src/components/movies/SearchBar.tsx"
      provides: "Search input that triggers movie search"
      min_lines: 15
    - path: "frontend/src/app/movies/[id]/page.tsx"
      provides: "Movie detail page route"
      min_lines: 20
    - path: "frontend/src/components/movies/MovieDetail.tsx"
      provides: "Full movie detail view with backdrop, synopsis, cast, trailer"
      min_lines: 50
    - path: "frontend/src/components/layout/Navbar.tsx"
      provides: "Top navigation bar with branding and auth controls"
      min_lines: 15
    - path: "frontend/src/lib/api.ts"
      provides: "API client for fetching from FastAPI backend"
      exports: ["fetchMovies", "searchMovies", "fetchMovieDetail"]
  key_links:
    - from: "frontend/src/lib/api.ts"
      to: "backend /api/movies endpoints"
      via: "fetch calls to NEXT_PUBLIC_API_URL"
      pattern: "NEXT_PUBLIC_API_URL"
    - from: "frontend/src/components/movies/MovieGrid.tsx"
      to: "frontend/src/lib/api.ts"
      via: "useQuery from TanStack Query"
      pattern: "useQuery.*movies"
    - from: "frontend/src/components/movies/MovieCard.tsx"
      to: "TMDB image CDN"
      via: "getImageUrl helper for poster images"
      pattern: "getImageUrl"
    - from: "frontend/src/app/movies/[id]/page.tsx"
      to: "frontend/src/lib/api.ts"
      via: "fetchMovieDetail call"
      pattern: "fetchMovieDetail"
    - from: "frontend/src/components/movies/MovieDetail.tsx"
      to: "YouTube embed"
      via: "iframe with trailer video key"
      pattern: "youtube.com/embed"
---

<objective>
Build the movie catalog browsing experience: a responsive grid of movie posters with search, pagination, and a rich movie detail page with synopsis, cast, trailers, and backdrop images.

Purpose: This is the core user-facing feature of Phase 1 -- the ability to discover and explore movies. It connects the frontend UI to the TMDB API backend endpoints and provides the visual foundation for the entire application.

Output: Browse page at /browse with movie grid, search bar, and pagination. Movie detail page at /movies/{id} with full movie information. Navbar with branding and auth controls.
</objective>

<execution_context>
@./.claude/get-shit-done/workflows/execute-plan.md
@./.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/01-foundation-data-infrastructure/01-01-SUMMARY.md
@.planning/phases/01-foundation-data-infrastructure/01-02-SUMMARY.md
@.planning/phases/01-foundation-data-infrastructure/01-03-SUMMARY.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Build API client, Navbar, browse page with movie grid, search, and pagination</name>
  <files>
    frontend/src/lib/api.ts
    frontend/src/components/layout/Navbar.tsx
    frontend/src/components/movies/MovieCard.tsx
    frontend/src/components/movies/MovieGrid.tsx
    frontend/src/components/movies/SearchBar.tsx
    frontend/src/app/browse/layout.tsx
    frontend/src/app/browse/page.tsx
    frontend/next.config.ts
  </files>
  <action>
    Create the API client, then build the catalog browsing UI.

    `frontend/src/lib/api.ts`:
    - Define `API_URL = process.env.NEXT_PUBLIC_API_URL || "http://localhost:8000"`
    - Export async functions that call the FastAPI backend:
      - `fetchMovies(page: number = 1): Promise<PaginatedResponse<Movie>>` -> GET `${API_URL}/api/movies?page=${page}`
      - `searchMovies(query: string, page: number = 1): Promise<PaginatedResponse<Movie>>` -> GET `${API_URL}/api/movies/search?query=${encodeURIComponent(query)}&page=${page}`
      - `fetchMovieDetail(id: number): Promise<MovieDetail>` -> GET `${API_URL}/api/movies/${id}`
    - Each function: fetch with no-cache, throw on non-ok response with status text, parse JSON
    - Import types from `@/types/movie`

    `frontend/next.config.ts`:
    - Add `images.remotePatterns` for TMDB image domain: `{ protocol: "https", hostname: "image.tmdb.org", pathname: "/t/p/**" }`
    - This allows Next.js `<Image>` component to load TMDB images

    `frontend/src/components/layout/Navbar.tsx`:
    - Client component ("use client")
    - Fixed top navbar with z-50, bg-slate-900/95 backdrop-blur, border-b border-slate-800
    - Left: Link to /browse with "NetflixRecs" text in red-600 font-bold text-xl
    - Right: LogoutButton component (from Plan 02)
    - Padding: px-6 py-3, flex justify-between items-center

    `frontend/src/components/movies/MovieCard.tsx`:
    - Client component
    - Props: `movie: Movie`
    - Renders: Next.js `<Image>` with TMDB poster (use `getImageUrl(movie.poster_path, "w342")`), fallback div if no poster
    - Below image: movie title (text-sm, truncate), release year, vote average with star icon
    - Wrapped in `<Link href={/movies/${movie.id}}>` for navigation to detail page
    - Hover effect: scale-105 transition-transform, slight shadow increase
    - Card: rounded-lg overflow-hidden bg-slate-800
    - Image aspect ratio: 2:3 (poster standard), use `aspect-[2/3]` or fixed height

    `frontend/src/components/movies/MovieGrid.tsx`:
    - Client component ("use client")
    - Props: `movies: Movie[]`, `isLoading: boolean`
    - Renders: responsive CSS grid of MovieCard components
    - Grid: `grid grid-cols-2 sm:grid-cols-3 md:grid-cols-4 lg:grid-cols-5 xl:grid-cols-6 gap-4`
    - Loading state: show skeleton grid (6-12 pulsing placeholder cards with animate-pulse bg-slate-800)
    - Empty state: "No movies found" centered text

    `frontend/src/components/movies/SearchBar.tsx`:
    - Client component ("use client")
    - Props: `onSearch: (query: string) => void`, `initialQuery?: string`
    - Renders: text input with search icon (magnifying glass via inline SVG or heroicons)
    - Styled: w-full max-w-md, bg-slate-800, border border-slate-700, rounded-lg, px-4 py-2, text-slate-200, placeholder-slate-500
    - Debounced input: 300ms debounce on onChange using setTimeout/clearTimeout (no extra deps needed)
    - On debounced value change: calls `onSearch(value)`
    - Clear button (x icon) when value is non-empty

    `frontend/src/app/browse/layout.tsx`:
    - Imports and renders `<Navbar />` at top
    - Main content area with `pt-16` to account for fixed navbar, `px-4 md:px-8 py-6`
    - Renders `{children}`

    `frontend/src/app/browse/page.tsx`:
    - Client component ("use client") for interactivity (search, pagination)
    - Uses TanStack Query `useQuery` for data fetching:
      - Query key: `["movies", searchQuery, page]`
      - Query fn: if searchQuery is set, call `searchMovies(searchQuery, page)`, else call `fetchMovies(page)`
      - keepPreviousData: true (smooth pagination)
    - State: `searchQuery` (string), `page` (number, starts at 1)
    - Layout:
      - Page heading: "Browse Movies" (text-2xl font-bold)
      - SearchBar below heading
      - When searching: show "Results for '{searchQuery}'" subtitle
      - MovieGrid with query results
      - Pagination below grid: "Previous" and "Next" buttons (disabled at boundaries), "Page X of Y" text
      - Buttons styled: bg-red-600 hover:bg-red-700 disabled:bg-slate-700 disabled:text-slate-500 px-4 py-2 rounded
    - Reset page to 1 when search query changes
  </action>
  <verify>
    - `cd frontend && npx tsc --noEmit` passes
    - Start both frontend and backend, navigate to /browse
    - Movie grid displays poster images from TMDB
    - Typing in search bar filters movies after 300ms debounce
    - Pagination buttons navigate between pages
    - Clicking a movie card navigates to /movies/{id}
    - Navbar displays "NetflixRecs" branding and Sign Out button
  </verify>
  <done>Browse page at /browse displays a responsive grid of TMDB movies with poster images. Search bar filters by title with debounce. Pagination loads additional pages. Navbar provides site-wide navigation and auth controls.</done>
</task>

<task type="auto">
  <name>Task 2: Build movie detail page with synopsis, cast, trailer, and backdrop</name>
  <files>
    frontend/src/app/movies/[id]/page.tsx
    frontend/src/components/movies/MovieDetail.tsx
  </files>
  <action>
    Create the movie detail page that shows rich information about a single movie.

    `frontend/src/components/movies/MovieDetail.tsx`:
    - Client component ("use client")
    - Props: `movie: MovieDetail` (from types)
    - Layout (top to bottom):

    **Backdrop section:**
    - Full-width backdrop image from TMDB (`getImageUrl(movie.backdrop_path, "w1280")`) with gradient overlay fading to bg-slate-900 at bottom
    - If no backdrop: solid slate-800 background
    - Absolute positioned content over backdrop:
      - Movie title (text-4xl font-bold)
      - Tagline in italic text-slate-400 (if exists)
      - Release year, runtime formatted as "Xh Ym", vote average with star

    **Info section (below backdrop):**
    - Two-column layout on desktop (lg:flex), single column on mobile
    - Left column (lg:w-2/3):
      - "Overview" heading with movie.overview paragraph (text-slate-300 leading-relaxed)
      - "Cast" heading with horizontal scroll of top 10 cast members
        - Each cast member: profile image (circular, w-16 h-16, object-cover) or initials placeholder, name (text-sm font-medium), character name (text-xs text-slate-400)
        - Horizontal flex with gap-4, overflow-x-auto
    - Right column (lg:w-1/3):
      - Genre tags: flex-wrap gap-2, each genre as `<span>` with bg-slate-700 text-slate-300 px-3 py-1 rounded-full text-sm
      - Poster image (if different visual needed, optional)

    **Trailer section:**
    - If movie.videos.results has a YouTube trailer (filter: `site === "YouTube" && type === "Trailer"`):
      - "Trailer" heading
      - Responsive YouTube embed: `<iframe>` with `src="https://www.youtube.com/embed/${video.key}"`, allowFullScreen, aspect-video container
    - If no trailer: skip section entirely (no "no trailer available" message)

    **Back button:**
    - Top-left of page, `<Link href="/browse">` with left arrow + "Back to Browse"
    - Styled: text-slate-400 hover:text-white, flex items-center gap-1

    `frontend/src/app/movies/[id]/page.tsx`:
    - Client component ("use client") -- uses TanStack Query for fetching
    - Extract `id` from params
    - Use TanStack Query `useQuery` with key `["movie", id]` and fn `fetchMovieDetail(Number(id))`
    - Loading state: full-page skeleton with pulsing backdrop area and content placeholders
    - Error state: "Movie not found" message with link back to /browse
    - Success: render `<MovieDetail movie={data} />`
    - Include the browse layout's Navbar by sharing the browse layout, OR import Navbar directly at top of this page
    - The page should include the Navbar. Either:
      - Move Navbar to root layout (preferred, so it shows on all authenticated pages), OR
      - Create a shared layout for authenticated pages, OR
      - Import Navbar directly in this page component
    - Preferred approach: Create `frontend/src/app/(main)/layout.tsx` as a route group layout that includes Navbar, then move browse/ and movies/ under (main)/. This means: `frontend/src/app/(main)/browse/page.tsx` and `frontend/src/app/(main)/movies/[id]/page.tsx`. BUT this would conflict with file paths in Task 1. Instead: just import Navbar in the movies/[id] page directly. This is simpler and avoids restructuring.
    - Actually, the SIMPLEST approach: Move Navbar rendering to the root `layout.tsx` and conditionally show it only on non-auth pages. Use a simple check: if the pathname starts with /login, /signup, or /reset-password, don't show navbar. This can be done in a client wrapper component. However, root layout is a server component.
    - FINAL APPROACH: Import Navbar at the top of `movies/[id]/page.tsx` directly. The browse layout already has it. This means Navbar appears on both browse and detail pages. Slight duplication but zero complexity.
  </action>
  <verify>
    - `cd frontend && npx tsc --noEmit` passes
    - Navigate to /movies/550 (Fight Club) -- should show:
      - Backdrop image with gradient overlay
      - Movie title, tagline, year, runtime, rating
      - Overview text
      - Cast members with photos
      - Genre tags
      - YouTube trailer embed (if available)
    - "Back to Browse" link navigates to /browse
    - Loading state shows skeleton while fetching
    - Invalid movie ID shows error state
  </verify>
  <done>Movie detail page at /movies/{id} displays backdrop with gradient, title, tagline, overview, cast carousel, genre tags, and YouTube trailer embed. Loading and error states handle edge cases. Back navigation returns to browse.</done>
</task>

<task type="checkpoint:human-verify" gate="blocking">
  <name>Task 3: Verify complete Phase 1 user experience</name>
  <files>None -- verification only</files>
  <action>
    Human verification checkpoint. No code changes -- user tests the complete Phase 1 experience.

    What was built: Complete Phase 1 foundation including auth flows (signup, login, logout, password reset), catalog browsing (movie grid with pagination and search), and movie detail pages (synopsis, cast, trailer, backdrop). Dark-themed UI with Netflix-inspired styling.

    Prerequisites: Ensure both servers are running:
    - Frontend: `cd frontend && npm run dev` (port 3000)
    - Backend: `cd backend && source venv/bin/activate && uvicorn main:app --reload --port 8000` (port 8000)
    - Ensure .env files are configured with real Supabase and TMDB credentials

    Test auth flow:
    1. Visit http://localhost:3000/signup -- you should see a dark-themed signup form
    2. Create an account with a real email -- you should see "Check your email for confirmation"
    3. Confirm your email via the link in the inbox
    4. Visit http://localhost:3000/login -- log in with the account you just created
    5. You should be redirected to /browse
    6. Close the browser, reopen, visit http://localhost:3000/browse -- you should still be logged in (session persistence)
    7. Click "Sign Out" in the navbar -- you should be redirected to /login

    Test catalog browsing:
    1. Visit http://localhost:3000/browse -- you should see a grid of popular movie posters
    2. Scroll down to see pagination -- click "Next" to load page 2
    3. Type "batman" in the search bar -- results should filter after a brief delay
    4. Clear the search -- popular movies should return

    Test movie detail:
    1. Click any movie poster -- you should navigate to /movies/{id}
    2. Verify: backdrop image, title, overview, cast members, genre tags
    3. If the movie has a trailer: verify YouTube embed loads
    4. Click "Back to Browse" -- you should return to /browse

    Visual check:
    - Dark slate theme throughout (no white backgrounds or light text on light)
    - Movie posters load from TMDB (not broken images)
    - Responsive: resize browser to mobile width -- grid should collapse to 2 columns
  </action>
  <verify>User confirms all Phase 1 success criteria pass by typing "approved"</verify>
  <done>User has verified: auth works end-to-end, catalog displays TMDB movies, search filters correctly, detail page shows rich movie info, and dark theme is consistent.</done>
</task>

</tasks>

<verification>
- TypeScript compiles: `cd frontend && npx tsc --noEmit`
- Browse page renders movie grid at /browse
- Search filters movies by title
- Pagination navigates between pages
- Movie detail page shows full info at /movies/{id}
- Navbar appears on both browse and detail pages
- TMDB images load correctly (poster and backdrop)
- YouTube trailer embeds play
</verification>

<success_criteria>
1. User can browse a paginated grid of movies with poster thumbnails at /browse
2. User can search for a movie by title and see filtered results
3. User can click a movie and see detail page with synopsis, cast, trailer, and backdrop image
4. Navbar provides site navigation and logout across all authenticated pages
5. Dark theme is consistent across all pages
6. Responsive layout works on mobile and desktop viewports
</success_criteria>

<output>
After completion, create `.planning/phases/01-foundation-data-infrastructure/01-04-SUMMARY.md`
</output>
