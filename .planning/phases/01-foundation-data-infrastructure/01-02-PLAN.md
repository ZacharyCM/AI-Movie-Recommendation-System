---
phase: 01-foundation-data-infrastructure
plan: 02
type: execute
wave: 1
depends_on: []
files_modified:
  - backend/main.py
  - backend/requirements.txt
  - backend/.env.example
  - backend/.gitignore
  - backend/config.py
  - backend/services/__init__.py
  - backend/services/tmdb.py
  - frontend/src/types/movie.ts
autonomous: true
user_setup:
  - service: tmdb
    why: "Movie and TV show catalog data, images, and trailers"
    env_vars:
      - name: TMDB_API_KEY
        source: "TMDB -> Settings -> API -> API Key (v3 auth)"
    dashboard_config:
      - task: "Create a TMDB account and request an API key"
        location: "https://www.themoviedb.org/settings/api"

must_haves:
  truths:
    - "FastAPI backend dev server starts without errors on port 8000"
    - "TMDB API client can fetch movie data when API key is configured"
    - "Movie TypeScript types can be imported in frontend code"
  artifacts:
    - path: "backend/main.py"
      provides: "FastAPI application entry point with CORS"
      contains: "FastAPI"
    - path: "backend/config.py"
      provides: "Backend settings via pydantic-settings"
      contains: "BaseSettings"
    - path: "backend/services/tmdb.py"
      provides: "TMDB API client service"
      contains: "TMDB_API_KEY"
    - path: "frontend/src/types/movie.ts"
      provides: "Shared Movie TypeScript types"
      contains: "interface Movie"
  key_links:
    - from: "backend/services/tmdb.py"
      to: "TMDB API"
      via: "TMDB_API_KEY env var"
      pattern: "TMDB_API_KEY"
    - from: "backend/main.py"
      to: "backend/config.py"
      via: "settings import"
      pattern: "from config import"
---

<objective>
Scaffold the FastAPI backend project with CORS, health check, TMDB API client service, and define shared Movie TypeScript types for the frontend.

Purpose: Establish the backend project structure and TMDB integration that API endpoints (Plan 04) depend on, plus the shared types that the catalog UI (Plan 05) needs. The backend must exist before any API routes can be added.

Output: Runnable FastAPI backend (port 8000) with health endpoint, configured TMDB client service, and Movie TypeScript types in the frontend.
</objective>

<execution_context>
@./.claude/get-shit-done/workflows/execute-plan.md
@./.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Scaffold FastAPI backend with CORS, health check, and TMDB client service</name>
  <files>
    backend/main.py
    backend/requirements.txt
    backend/.env.example
    backend/.gitignore
    backend/config.py
    backend/services/__init__.py
    backend/services/tmdb.py
  </files>
  <action>
    Create a `backend/` directory at project root:
    - Create `backend/requirements.txt` with: `fastapi==0.115.0`, `uvicorn[standard]==0.30.0`, `httpx==0.27.0`, `python-dotenv==1.0.1`, `pydantic==2.9.0`, `pydantic-settings==2.5.0`
    - Create `backend/config.py`: use pydantic-settings `BaseSettings` to load `TMDB_API_KEY` and `FRONTEND_URL` (default `http://localhost:3000`) from environment / .env file
    - Create `backend/main.py`: FastAPI app with CORS middleware allowing `FRONTEND_URL` origin, GET `/health` endpoint returning `{"status": "ok"}`. Import settings from config.py. Use `from dotenv import load_dotenv; load_dotenv()` at module level.
    - Create `backend/.env.example` with: `TMDB_API_KEY=your_tmdb_api_key`, `FRONTEND_URL=http://localhost:3000`
    - Create `backend/.gitignore` with: `__pycache__/`, `*.pyc`, `.env`, `venv/`, `.venv/`
    - Set up Python virtual environment: `cd backend && python3 -m venv venv && source venv/bin/activate && pip install -r requirements.txt`
    - Verify `uvicorn main:app --reload` starts and `curl http://localhost:8000/health` returns ok, then stop it

    Create TMDB API client for FastAPI backend:

    `backend/services/__init__.py`: empty file
    `backend/services/tmdb.py`:
    - Import `httpx` for async HTTP calls and settings from config
    - Define constants: `TMDB_BASE_URL = "https://api.themoviedb.org/3"`, `TMDB_IMAGE_BASE = "https://image.tmdb.org/t/p"`
    - Create class `TMDBService` with async methods:
      - `get_popular(page: int = 1)` -> calls `/movie/popular` with api_key param, returns parsed response
      - `search_movies(query: str, page: int = 1)` -> calls `/search/movie` with query + api_key params
      - `get_movie_details(movie_id: int)` -> calls `/movie/{movie_id}` with `append_to_response=credits,videos` for cast + trailers
    - Each method uses `httpx.AsyncClient` context manager, raises `httpx.HTTPStatusError` on failure
    - Include helper to build full image URLs: `get_image_url(path: str, size: str = "w500") -> str`
  </action>
  <verify>
    - `cd backend && source venv/bin/activate && uvicorn main:app --host 0.0.0.0 --port 8000` starts FastAPI (stop after confirming)
    - `curl http://localhost:8000/health` returns `{"status":"ok"}`
    - `cd backend && python -c "from services.tmdb import TMDBService; from config import Settings; print('OK')"`
  </verify>
  <done>FastAPI backend starts on port 8000 with health endpoint. TMDB service class with popular/search/detail methods created. Config loads env vars via pydantic-settings.</done>
</task>

<task type="auto">
  <name>Task 2: Define shared Movie TypeScript types for frontend</name>
  <files>
    frontend/src/types/movie.ts
  </files>
  <action>
    Create shared TypeScript types that mirror the TMDB API response structure. These types will be used by the catalog UI (Plan 05) and API client.

    `frontend/src/types/movie.ts`:
    - `interface Movie { id: number; title: string; overview: string; poster_path: string | null; backdrop_path: string | null; release_date: string; vote_average: number; vote_count: number; genre_ids: number[]; }`
    - `interface MovieDetail extends Movie { runtime: number | null; genres: { id: number; name: string }[]; tagline: string | null; credits: { cast: CastMember[] }; videos: { results: Video[] }; }`
    - `interface CastMember { id: number; name: string; character: string; profile_path: string | null; order: number; }`
    - `interface Video { id: string; key: string; name: string; site: string; type: string; }`
    - `interface PaginatedResponse<T> { page: number; results: T[]; total_pages: number; total_results: number; }`
    - Export `TMDB_IMAGE_BASE = "https://image.tmdb.org/t/p"` constant and helper `getImageUrl(path: string | null, size?: string): string` that returns full URL or a placeholder

    NOTE: This file lives in `frontend/src/types/` but is written as part of the backend plan because it mirrors the TMDB API response structure defined by the backend. The frontend project must exist first (created by Plan 01), so this task should be executed after verifying `frontend/src/types/` directory is available. If running in parallel with Plan 01, the executor should create the directory if it doesn't exist yet.
  </action>
  <verify>
    - `frontend/src/types/movie.ts` exports Movie, MovieDetail, CastMember, Video, PaginatedResponse types
    - If frontend project exists: `cd frontend && npx tsc --noEmit` passes
  </verify>
  <done>Movie TypeScript types defined with all TMDB fields needed by catalog and detail pages. Types mirror the TMDB API structure for consistent frontend-backend alignment.</done>
</task>

</tasks>

<verification>
- `uvicorn main:app --reload` in backend/ starts without errors
- Python imports work: `cd backend && python -c "from services.tmdb import TMDBService; from config import Settings"`
- `.env.example` documents all required env vars
- `frontend/src/types/movie.ts` contains Movie, MovieDetail, PaginatedResponse interfaces
</verification>

<success_criteria>
1. FastAPI backend starts on port 8000 with /health endpoint
2. TMDB service class can fetch popular movies, search, and movie details
3. Movie TypeScript types cover all fields needed for grid and detail views
4. Environment variable template documents TMDB configuration
</success_criteria>

<output>
After completion, create `.planning/phases/01-foundation-data-infrastructure/01-02-SUMMARY.md`
</output>
